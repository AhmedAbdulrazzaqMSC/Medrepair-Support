
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Technician App</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
  <script src="https://unpkg.com/@zxing/library@latest"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    button { padding: 10px 15px; margin: 5px; }
    .hidden { display: none; }
    textarea { width: 100%; height: 100px; }
    input, select { width: 100%; margin-bottom: 10px; padding: 8px; }
    .section { margin-top: 20px; }
  </style>
</head>
<body>
  <h2>Technician Mobile App</h2>
  <button onclick="showSection('repair')">ðŸ“· New Repair Report</button>
  <button onclick="showSection('sop')">ðŸ“– SOP Library</button>

  <div id="repair" class="section" style="display:none;">
    <h3>Repair Report</h3>
    <label>Container Number: <input type="text" /></label>
    <label>Model Number (Auto): <input id="modelInput" type="text" /></label>
    <label>Serial Number (Auto): <input id="serialInput" type="text" /></label>
    <label>Date: <input type="date" /></label>
    <label>Technician Name: <input type="text" /></label>
    <label>Upload Info Plate Image for OCR: <input type="file" accept="image/*" onchange="runOCR(event)" /></label>
    <label>Scan Barcode (Model Number):</label>
    <video id="barcode-video" width="300" height="200" style="border:1px solid gray;"></video>
    <button onclick="startBarcodeScan()">Start Barcode Scan</button>
    <label>Supply Temp Before/After: <input type="text" /></label>
    <label>Return Temp Before/After: <input type="text" /></label>
    <label>Description: <textarea></textarea></label>
    <button>Submit (to Excel backend)</button>
  </div>

  <div id="sop" class="section" style="display:none;">
    <h3>SOP Viewer</h3>
    <select onchange="loadSOP(this.value)">
      <option value="">-- Select SOP --</option>
      <option value="monitoring">Monitoring</option>
      <option value="connection">Connection</option>
      <option value="disconnection">Disconnection</option>
      <option value="log_in">Log In</option>
      <option value="log_off">Log Off</option>
      <option value="problems">Common Problems</option>
    </select>
    <div id="sop-content" style="margin-top:15px;"></div>
  </div>

  <script>
    function showSection(id) {
      document.getElementById("repair").style.display = "none";
      document.getElementById("sop").style.display = "none";
      document.getElementById(id).style.display = "block";
    }

    function runOCR(event) {
      const file = event.target.files[0];
      if (!file) return;
      Tesseract.recognize(file, 'eng').then(({ data: { text } }) => {
        const modelMatch = text.match(/Model Number[:\s]*([\w-]+)/i);
        const serialMatch = text.match(/Serial Number[:\s]*([\w-]+)/i);
        if (modelMatch) document.getElementById("modelInput").value = modelMatch[1];
        if (serialMatch) document.getElementById("serialInput").value = serialMatch[1];
        alert("OCR complete.");
      });
    }

    function startBarcodeScan() {
      const codeReader = new ZXing.BrowserBarcodeReader();
      codeReader.decodeFromVideoDevice(null, 'barcode-video', (result, err) => {
        if (result) {
          document.getElementById("modelInput").value = result.text;
          codeReader.reset();
          alert("Barcode scanned: " + result.text);
        }
      });
    }

    const SOP_DATA = {
      monitoring: "Check temperatures, power status, alarms and visual indicators every 4 hours...",
      connection: "Ensure the power plug is secure, switch on P-Dat, confirm green LED, and wait for status screen...",
      disconnection: "Log off from P-Dat, shut down unit properly, then unplug from power source safely...",
      log_in: "From P-Dat, select 'Log In', scan your ID, verify unit serial and temperature settings...",
      log_off: "Select 'Log Off' on P-Dat, confirm unit is stable, and note container ID before disconnection...",
      problems: "If P-Dat does not power on, check cable, try alternate socket, and inspect unit fuse..."
    };

    function loadSOP(key) {
      const content = SOP_DATA[key] || "";
      document.getElementById("sop-content").innerText = content;
    }
  </script>
</body>
</html>
