<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Technician Report with OCR</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2/dist/tesseract.min.js"></script>
</head>
<body>
  <h2>Repair Report</h2>

  <form>
    <p><label>Container Number:<br>
      <input type="text" id="container_number" name="container_number">
    </label></p>

    <p><label>Model Number (Auto):<br>
      <input type="text" id="model_input" name="model_input" placeholder="Model Number">
    </label></p>

    <p><label>Serial Number (Auto):<br>
      <input type="text" id="serial_input" name="serial_input" placeholder="Serial Number">
    </label></p>

    <p><label>Date:<br>
      <input type="date" id="date_input" name="date_input">
    </label></p>

    <p><label>Technician Name:<br>
      <input type="text" id="tech_name" name="tech_name">
    </label></p>

    <p><label>Upload Info Plate Image for OCR:<br>
      <input type="file" id="plate-upload" accept="image/*">
    </label>
    <button type="button" id="extract-btn">Extract Info</button></p>

    <p><label>Refrigerant Type:<br>
      <input type="text" id="refrigerant_input" name="refrigerant_input" placeholder="Refrigerant Type">
    </label></p>

    <p><label>Warranty ID:<br>
      <input type="text" id="warranty_input" name="warranty_input" placeholder="Warranty ID">
    </label></p>

    <div id="ocr-status" style="margin-top:10px;"></div>
  </form>

  <script>
    document.getElementById('extract-btn').addEventListener('click', () => {
      const fileInput = document.getElementById('plate-upload');
      const file = fileInput.files[0];
      if (!file) return alert('Select an image first.');

      const status = document.getElementById('ocr-status');
      status.innerText = 'Extracting infoâ€¦';

      Tesseract.recognize(file, 'eng')
        .then(({ data: { text } }) => {
          status.innerText = 'OCR Raw Output:\n' + text;

          const fields = {
            model: text.match(/Model Number:\s*([A-Z0-9\-]+)/i)?.[1] || '',
            serial: text.match(/Serial Number:\s*([A-Z0-9]+)/i)?.[1] || '',
            date: text.match(/Date of Manufacture:\s*([0-9\/]+)/i)?.[1] || '',
            refrigerant: text.match(/R-134A|R-404A|R-452A/i)?.[0] || '',
            warranty: text.match(/Warranty.?ID.?Number.?[:\s]+(\d{7})/i)?.[1] || ''
          };

          document.getElementById('model_input').value = fields.model;
          document.getElementById('serial_input').value = fields.serial;
          document.getElementById('date_input').value = fields.date;
          document.getElementById('refrigerant_input').value = fields.refrigerant;
          document.getElementById('warranty_input').value = fields.warranty;
        })
        .catch(err => {
          console.error(err);
          status.innerText = 'OCR error. Check console.';
        });
    });
  </script>
</body>
</html>
