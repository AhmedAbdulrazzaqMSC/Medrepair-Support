<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Medrepair OCR Clean</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2/dist/tesseract.min.js"></script>
</head>
<body>
  <h2>Technician Report with OCR</h2>

  <form>
    <label>Info Plate Image:
      <input type="file" id="plate-upload" accept="image/*">
    </label>
    <button type="button" id="extract-btn">Extract Info</button>
    <div id="ocr-status"></div>

    <p><input id="model_input" name="model" placeholder="Model Number"></p>
    <p><input id="serial_input" name="serial" placeholder="Serial Number"></p>
    <p><input id="date_input" name="manufacture_date" placeholder="MM/YYYY"></p>
    <p><input id="refrigerant_input" name="refrigerant" placeholder="Refrigerant Type"></p>
    <p><input id="warranty_input" name="warranty_id" placeholder="Warranty ID"></p>
  </form>

  <script>
    document.getElementById('extract-btn').addEventListener('click', () => {
      const fileInput = document.getElementById('plate-upload');
      const file = fileInput.files[0];
      if (!file) return alert('Select an image first.');

      const status = document.getElementById('ocr-status');
      status.innerText = 'Extracting infoâ€¦';

      Tesseract.recognize(file, 'eng')
        .then(({ data: { text } }) => {
          status.innerText = 'OCR Raw Output:\n' + text;

          const fields = {
            model: text.match(/Model Number:\s*([A-Z0-9\-]+)/i)?.[1] || '',
            serial: text.match(/Serial Number:\s*([A-Z0-9]+)/i)?.[1] || '',
            date: text.match(/Date of Manufacture:\s*([0-9\/]+)/i)?.[1] || '',
            refrigerant: text.match(/R-134A|R-404A|R-452A/i)?.[0] || '',
            warranty: text.match(/Warranty.?ID.?Number.?[:\s]+(\d{7})/i)?.[1] || ''
          };

          document.getElementById('model_input').value = fields.model;
          document.getElementById('serial_input').value = fields.serial;
          document.getElementById('date_input').value = fields.date;
          document.getElementById('refrigerant_input').value = fields.refrigerant;
          document.getElementById('warranty_input').value = fields.warranty;

          status.innerText = 'Done. Review & submit.';
        })
        .catch(err => {
          console.error(err);
          status.innerText = 'OCR error. Check console.';
        });
    });
  </script>
</body>
</html>
